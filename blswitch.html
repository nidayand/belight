<!-- *********************************************
        DATASOURCE: switch node

     ********************************************* -->
<script type="text/x-red" data-help-name="bl-switch out">
    <p>A source definition node. Will store the current value of the datasource</p>
    <p>Will store whatever is in <b>msg.payload</b> into a datasource collection in the defined MongoDB</p>
    <p><b>Broadcast broker</b> is the MQTT server that will be used for communicating between the different Belight nodes. When defining enter a prepend string to be used to uniquely identify Belight messages</p>
    <p>If the value should only be valid for a certain period mark the expiration flag and define for how long it will be valid. It is also important to define the value that should be set for the datasource when it is expired. Default is "false"</p>
</script>
<script type="text/x-red" data-template-name="bl-switch out">
    <div class="form-row">
        <label for="node-input-bldb"><i class="fa fa-bookmark"></i> Store</label>
        <input type="text" id="node-input-bldb">
    </div>
    <div class="form-row">
        <label for="node-input-timeout"><i class="fa fa-clock-o"></i> Send code</label>
        <input type="text" id="node-input-times" placeholder="Number" style="direction:rtl; width:50px !important">
        <span>times</span>
    </div>
    <div class="form-row">
        <label for="node-input-timeout"><i class="fa fa-clock-o"></i> Repeat every</label>
        <input type="text" id="node-input-repeat" placeholder="Time" style="direction:rtl; width:50px !important">
        <select id="node-input-repeatUnits" style="width:200px !important">
          <option value="milliseconds">Milliseconds</option>
          <option value="seconds">Seconds</option>
          <option value="minutes">Minutes</option>
          <option value="hours">Hours</option>
          <option value="days">Days</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-bookmark"></i> Name</label>
        <input type="text" id="node-input-name">
    </div>

</script>
<script type="text/javascript">
    function oneditprepareDatasource() {
        $("#node-input-expire").change(function () {
            if ($("#node-input-expire").is(':checked')){
                $("#expire-details").show();
            } else {
                $("#expire-details").hide();
            }
        });

    }
    RED.nodes.registerType('bl-switch out', {
        category: 'belight-output',
        color: "#FFCC66",
        defaults: {
            bldb: {type: "bl-store", required: true},
            name: {value: "", required: true},
            blbroker: {type: "bl-broker", required: true},
            expire: {value: false, required: true},
            timeout: {value: 100, required: false, validate: RED.validators.number()},
            timeoutUnits: {value: "seconds", required: false},
            expval : {value: false, required: false},
            output: {value:false, required:true }
        },
        inputs: 1,
        outputs: 1,
        icon: "lightswitch.png",
        align: "right",
        label: function() {
            return "Source: " + (this.name ? this.name : "undefined");
        },
        labelStyle: function() {
            return (this.name ? "node_label_italic" : "");
        },
        oneditprepare: oneditprepareDatasource,
        oneditsave: function(){
            var node=this;
            if ($("#node-input-output").is(":checked")){
                node.outputs=1;
            } else {
                node.outputs=0;
            }
        }
    });
</script>
