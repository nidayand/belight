<!-- *********************************************
        DATASOURCE: rule in node



     ********************************************* -->
<script type="text/x-red" data-help-name="rule in">
    <p>Bla bla bla</p>
</script>
<script type="text/x-red" data-template-name="rule in">
    <div class="form-row">
        <label for="node-input-bldb"><i class="fa fa-bookmark"></i> Store</label>
        <input type="text" id="node-input-bldb">
    </div>
    <div class="form-row">
        <label for="node-input-blbroker"><i class="fa fa-bookmark"></i> Broadcast broker</label>
        <input type="text" id="node-input-blbroker">
    </div>
    <div class="form-row" style="padding-top:10px;">
        <i class="fa fa-bookmark"></i> Rules</label>
    </div>
    <div class="form-row">
        <div id="node-input-rule-container-div" style="border-radius: 5px; height: 310px; padding: 5px; border: 1px solid #ccc; overflow-y:scroll;">
        <ol id="node-input-rule-container" style=" list-style-type:none; margin: 0;">
        </ol>
        </div>
        <a href="#" class="btn btn-mini" id="node-input-add-rule" style="margin-top: 4px;"><i class="fa fa-plus"></i> Add</a>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<script type="text/javascript">
    function oneditprepare() {
        var operators = [
                {v:"eq",t:"=="},
                {v:"neq",t:"!="},
                {v:"lt",t:"<"},
                {v:"lte",t:"<="},
                {v:"gt",t:">"},
                {v:"gte",t:">="},
                {v:"btwn",t:"is between"},
                {v:"cont",t:"contains"},
                {v:"regex",t:"matches regex"},
                {v:"true",t:"is true"},
                {v:"false",t:"is false"},
                {v:"null",t:"is null"},
                {v:"nnull",t:"is not null"},
                {v:"else",t:"otherwise"}
            ],
        generateRule = function(i, rule){
        }

        //HOW TO GET THE CONFIG NODES - TODO
        RED.nodes.eachConfig(function(node){console.log(node)})

        // Manage the add new rule button
        $("#node-input-add-rule").click(function() {
                generateRule($("#node-input-rule-container").children().length+1,{t:"",v:"",v2:""});
                $("#node-input-rule-container-div").scrollTop($("#node-input-rule-container-div").get(0).scrollHeight);
        });

        //Manage resizing of the dialog
        function switchDialogResize(ev,ui) {
                $("#node-input-rule-container-div").css("height",(ui.size.height-260)+"px");
        };
        $( "#dialog" ).on("dialogresize", switchDialogResize);
        $( "#dialog" ).one("dialogopen", function(ev) {
            var size = $( "#dialog" ).dialog('option','sizeCache-switch');
            if (size) {
                switchDialogResize(null,{size:size});
            }
        });
        $( "#dialog" ).one("dialogclose", function(ev,ui) {
            $( "#dialog" ).off("dialogresize",switchDialogResize);
        });

    }
    RED.nodes.registerType('rule in', {
        category: 'belight-input',
        color: "#D7D7A0",
        defaults: {
            bldb: {type: "bldb", required: true},
            name: {value: "", required: true},
            blbroker: {type: "blbroker", required: true},
            rules: {value: [{t:"eq", v:""}]}
        },
        inputs: 0,
        outputs: 1,
        icon: "rule.png",
        align: "right",
        label: function() {
            return "Rule: "+this.name;
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: oneditprepare
    });
</script>
